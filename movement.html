
<!doctype html>
<html><head><meta charset="utf-8"/><title>Osler Wellness — Movements</title>
<style>
  body{{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#2f3d44;color:#fff;margin:0}}
  .wrap{{max-width:1100px;margin:24px auto;padding:0 16px}}
  h1{{margin:0 0 12px}}
  .card{{background:#3b4d54;border:1px solid #556e77;border-radius:14px;padding:16px;margin:16px 0}}
  table{{width:100%;border-collapse:collapse}}
  th,td{{padding:10px;border-bottom:1px solid #556e77}}
  th{{text-align:left;background:#3f5962;position:sticky;top:0}}
  .rowhead{{font-weight:600}}
  .tabs{{display:flex;gap:10px;margin-bottom:10px}}
  .tab{{background:#445a62;border:1px solid #556e77;border-radius:10px;padding:8px 12px;text-decoration:none;color:#fff}}
  .muted{{opacity:.8}}
  a,a:visited{{color:#fff}}
</style>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
  window.SB_URL  = "https://zwocjuiqkmfgtenzjdcy.supabase.co";
  window.SB_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp3b2NqdWlxa21mZ3RlbnpqZGN5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTAwMDAwMDAsImV4cCI6MjA3MjU0NTgwMX0.c4OyvfF3tfFM6uwaEcbUMh6WJJqythetshxThrMuAQg";
  function sb(){{ return window.supabase.createClient(SB_URL, SB_ANON); }}
  async function load() {{
    const {{ data, error }} = await sb()
      .from('movements_with_products')
      .select('*')
      .eq('type','dispense')
      .order('created_at',{{ascending:false}})
      .limit(500);
    if (error) {{ document.querySelector('#err').textContent = error.message; return; }}
    const rh1 = data.filter(r=>r.from_loc==='RH1');
    const sv  = data.filter(r=>r.from_loc==='SV');
    const render = (rows, el) => {{
      const tbody = el.querySelector('tbody');
      tbody.innerHTML = rows.map(r=>`
        <tr>
          <td class="rowhead">${{new Date(r.created_at).toLocaleString()}}</td>
          <td>${{r.patient_id||''}}</td>
          <td>${{r.product_name}}</td>
          <td>${{r.qty_out}}</td>
          <td>${{r.unit_price ?? ''}}</td>
          <td>${{r.line_total ?? ''}}</td>
          <td>${{r.from_loc}}</td>
          <td>${{r.voided ? 'VOID' : 'OK'}}</td>
        </tr>`).join('');
    }};
    render(rh1, document.querySelector('#tbl_rh1'));
    render(sv,  document.querySelector('#tbl_sv'));
  }}
  window.addEventListener('DOMContentLoaded', load);
</script>
</head>
<body>
  <div class="wrap">
    <div class="tabs">
      <a class="tab" href="inventory.html">← Inventory</a>
      <span class="muted">Live dispense movements (last 500)</span>
    </div>
    <h1>Movements</h1>
    <div id="err" style="color:#ff9"></div>

    <div class="card">
      <h2>Raffles (RH1)</h2>
      <table id="tbl_rh1">
        <thead><tr><th>Date/Time</th><th>Patient ID</th><th>Product</th><th>Qty</th><th>Unit $</th><th>Total $</th><th>Loc</th><th>Status</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="card">
      <h2>Star Vista (SV)</h2>
      <table id="tbl_sv">
        <thead><tr><th>Date/Time</th><th>Patient ID</th><th>Product</th><th>Qty</th><th>Unit $</th><th>Total $</th><th>Loc</th><th>Status</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</body>
</html>
