<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Dispense</title>
  <style>
    body { background:#111; color:#eee; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .panel { max-width:900px; margin:24px auto; background:#1c1c1c; padding:24px; border-radius:14px; box-shadow:0 6px 24px rgba(0,0,0,.3); }
    label { display:block; margin-top:14px; font-size:14px; color:#bbb; }
    select, input, textarea { width:100%; padding:10px 12px; border-radius:10px; border:1px solid #333; background:#0f0f0f; color:#fff; }
    .row { display:grid; grid-template-columns:1fr 140px 140px; gap:12px; }
    .actions { margin-top:18px; display:flex; gap:12px; }
    button { background:#ff7a18; color:#111; border:none; padding:10px 16px; border-radius:10px; cursor:pointer; font-weight:700; }
    button:disabled { opacity:.6; cursor:not-allowed; }
  </style>
  <!-- Supabase client: keep your production version if you already load it globally -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // If your page already initializes window.supabase, remove this block.
    // Placeholder init (safe no-op if you keep your existing one).
    (function(){
      if (!window.supabase) {
        // WARNING: replace with your actual anon key and url *or* rely on your existing init.
        const url  = window.SUPABASE_URL  || "https://example.supabase.co";
        const key  = window.SUPABASE_ANON_KEY || "public-anon-key";
        try { window.supabase = supabase.createClient(url, key); } catch(e){}
      }
    })();
  </script>
</head>
<body>
  <div class="panel">
    <h2>Dispense</h2>
    <form id="dispenseForm">
      <label>Product</label>
      <select id="productSelect"></select>

      <div class="row">
        <div>
          <label>Location</label>
          <select id="locationSelect">
            <option value="SV">SV</option>
            <option value="RH1">RH1</option>
          </select>
        </div>
        <div>
          <label>Quantity</label>
          <input id="qtyInput" type="number" min="1" value="1"/>
        </div>
        <div>
          <label>Doctor initials</label>
          <input id="doctorInitialsInput" placeholder="e.g. JD"/>
        </div>
      </div>

      <label>Patient ID</label>
      <input id="patientIdInput" placeholder="optional"/>

      <label>Dosage / Remarks</label>
      <input id="remarksInput" placeholder="1 Tab per day"/>

      <div class="actions">
        <button id="submitBtn" type="submit">Submit</button>
      </div>
    </form>
  </div>

  <script src="./dispense.js"></script>
  <script>
    // OPTIONAL: simple product dropdown loader using your existing view
    (async function loadProducts(){
      if (!window.supabase) return;
      const sel = document.getElementById('productSelect');
      try {
        const { data, error } = await supabase
          .from('products_with_balances')
          .select('id,name,sku')
          .order('name', { ascending: true });
        if (error) throw error;
        sel.innerHTML = (data||[]).map(r => 
          `<option value="${r.id}">${r.name}${r.sku ? ' ('+r.sku+')' : ''}</option>`
        ).join('');
      } catch(e) { console.warn(e); }
    })();
  </script>
</body>
</html>